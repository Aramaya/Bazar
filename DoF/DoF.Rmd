---
title: "DoF"
author: "Julien Waseige"
date: "15/05/2021"
output: html_document
runtime: shiny
---

```{r setup,include=FALSE}
##### Setup
# Setting base config
knitr::opts_chunk$set(echo = TRUE,label_list=TRUE,comment = "",fig.align = "center")# This will make figures appears in the center of the document
# Loading all required lib
lapply(c("knitr",
         "stringr"
         ),
       require,
       character.only = TRUE)
# Setting some other confing
options(xtable.floating = FALSE,xtable.timestamp = "",xtable.comment = FALSE)
# Core set up
path = "pictures/"# Pictures path
raw = list.files(path)# Getting all names
pattern = "*[0123456789]*.png"# Loading all pattern
type = levels(as.factor(unlist(gsub(pattern,"",raw))))# Getting all card type
data = as.data.frame(cbind(raw,rep("",length(raw)),rep(0,length(raw))))# Assigning all card name into a dataset
colnames(data) = c("Nom","Type","Quantité")# Giving right name to dataset variables
data$Quantité = as.numeric(data$Quantité)# Ensure that nbrcard are numerical
nbrtype = c(1,1,2,3,1,4,2)# Number of card per type (should be reactive)
##### Attributing correct name to card
for (i in 1:length(type)) {
 data$Type[which(str_detect(raw,type[i]))] = type[i] 
 data$Quantité[which(data$Type == type[i])] = nbrtype[i]
}
##### To be made as a GitHub URL
#githubURL <- "https://github.com/thefactmachine/hex-binning-gis-data/raw/master/popDensity.RData"
#load(url(githubURL))
#head(df)
```

```{r sample,echo=FALSE}
##### Setting up the game
n = 1# Number of player ; to be made reactive
# Allways armed
# Dungeon
# Hord
# Boss
# Reward
w.sample = sample(which(data$Type == "W"))
weapons = data[w.sample[1:2*n],1]
donjon = sample(data[which(data$Type == "encounter" | data$Type == "mob"),1],3*n)
deck.reward = which(data[-w.sample[1:2*n],"Type"] == "bonus" | 
      data[-w.sample[1:2*n],"Type"] == "item" |
      data[-w.sample[1:2*n],"Type"] == "W")
reward = sample(data[deck.reward,1],4*n)
hord = sample(which(data$Type == "horde"),1)
boss = sample(which(data$Type == "Boss"),1)
```

# Choix des armes: 

```{r armes,echo=FALSE}
# Implémenter a reroll pour les armes. Avec update 
include_graphics(paste0(path,weapons[1]),dpi = NA) ; include_graphics(paste0(path,weapons[2]),dpi = NA)
```

# 1er tirage: 

```{r donjon,echo=FALSE}
##### 1st match
h4("Premier affrontement")

renderImage({list(src = paste0(path,donjon[1]))})

if(levels(as.factor(unlist(gsub(pattern,"",donjon[1])))) == "mob") actionButton("defeated", "Réclamer votre récompense")

conditionalPanel(
             condition = "input.defeated", 
             column(6,
                    renderImage({list(src = paste0(path,reward[1]))})
                    ))
```

